<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—‘ì…€ ì—°ë™ ì–´íœ˜ í€´ì¦ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #F5F5DC; /* Calm Beige */
        }
        .quiz-card {
            background-color: #FFFFFF;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease-in-out;
        }
        .btn-primary {
            background-color: #6B8E23; /* Sage Green */
            color: white;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #556B2F; /* Darker Sage */
        }
        .btn-primary:disabled {
            background-color: #909d7a;
            cursor: not-allowed;
        }
        .btn-option {
            background-color: #F0EAD6; /* Light Beige */
            border: 2px solid #D2B48C; /* Tan */
            color: #333;
            transition: all 0.2s ease-in-out;
        }
        .btn-option:hover {
            background-color: #D2B48C;
            color: white;
        }
        .btn-option.correct {
            background-color: #22C55E; /* Green 500 */
            border-color: #16A34A; /* Green 600 */
            color: white;
        }
        .btn-option.incorrect {
            background-color: #EF4444; /* Red 500 */
            border-color: #DC2626; /* Red 600 */
            color: white;
        }
        .progress-bar-inner {
            transition: width 0.5s ease-in-out;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="app-container" class="w-full max-w-2xl mx-auto">

        <div id="start-screen" class="text-center p-8 quiz-card">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">ì–´íœ˜ë ¥ í€´ì¦ˆ ì±Œë¦°ì§€</h1>
            <p class="text-lg text-gray-600 mb-8">ì—‘ì…€ íŒŒì¼ì˜ ë‹¨ì–´ë“¤ì„ í€´ì¦ˆë¡œ í™•ì¸í•´ ë³´ì„¸ìš”. ì¤€ë¹„ê°€ ë˜ë©´ ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!</p>
            <button id="start-btn" class="w-full md:w-1/2 py-4 px-6 text-xl font-bold rounded-lg btn-primary">
                í€´ì¦ˆ ì‹œì‘í•˜ê¸°
            </button>
        </div>

        <div id="quiz-screen" class="hidden">
            <div class="p-6 sm:p-8 quiz-card">
                <div class="flex justify-between items-center mb-4">
                    <p class="text-sm font-semibold text-gray-500">ì§„í–‰ë„</p>
                    <p id="progress-text" class="text-sm font-bold text-gray-700">1 / 10</p>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5 mb-6">
                    <div id="progress-bar" class="bg-[#6B8E23] h-2.5 rounded-full progress-bar-inner" style="width: 10%"></div>
                </div>

                <div class="text-center mb-8">
                    <p class="text-lg text-gray-600 mb-2">ë‹¤ìŒ ì„¤ëª…ì— í•´ë‹¹í•˜ëŠ” ì˜ì–´ ë‹¨ì–´ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?</p>
                    <h2 id="question" class="text-2xl sm:text-3xl font-bold text-gray-800 h-24 flex items-center justify-center">Question text goes here</h2>
                </div>

                <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    </div>
            </div>
        </div>

        <div id="results-screen" class="hidden text-center p-8 quiz-card">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">í€´ì¦ˆ ê²°ê³¼</h1>
            <p class="text-2xl text-gray-600 mb-6">ì´ <span id="score" class="font-bold text-[#6B8E23]">0</span>ì ì„ íšë“í–ˆìŠµë‹ˆë‹¤!</p>
            
            <div id="incorrect-answers-container" class="text-left mb-8">
                <h3 class="text-xl font-semibold text-gray-700 border-b-2 pb-2 mb-4">ë‹¤ì‹œ í•™ìŠµí•´ ë³´ì„¸ìš”!</h3>
                <ul id="incorrect-list" class="space-y-3">
                    </ul>
            </div>

            <button id="restart-btn" class="w-full md:w-1/2 py-4 px-6 text-xl font-bold rounded-lg btn-primary">
                ë‹¤ì‹œ í’€ì–´ë³´ê¸°
            </button>
        </div>
    </div>

    <script>
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultsScreen = document.getElementById('results-screen');
        
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');

        const questionEl = document.getElementById('question');
        const optionsContainer = document.getElementById('options-container');
        const progressText = document.getElementById('progress-text');
        const progressBar = document.getElementById('progress-bar');
        const scoreEl = document.getElementById('score');
        const incorrectList = document.getElementById('incorrect-list');

        let allWords = []; // ì—‘ì…€ì—ì„œ ë¶ˆëŸ¬ì˜¨ ëª¨ë“  ë‹¨ì–´ë¥¼ ì €ì¥í•  ë°°ì—´
        let shuffledWords, currentWordIndex, score, incorrectAnswers;
        const QUIZ_LENGTH = 10;

        // 2. ì—‘ì…€ íŒŒì¼ì„ ë¡œë“œí•˜ê³  íŒŒì‹±í•˜ëŠ” í•¨ìˆ˜
        async function loadQuizData() {
            try {
                // './quiz.xlsx'ëŠ” ì´ HTML íŒŒì¼ê³¼ ë™ì¼í•œ ìœ„ì¹˜ì— íŒŒì¼ì´ ìˆë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.
                // ë§Œì•½ /data/quiz.xlsx ì²˜ëŸ¼ ë‹¤ë¥¸ í´ë”ì— ìˆë‹¤ë©´ ê²½ë¡œë¥¼ ìˆ˜ì •í•´ì£¼ì„¸ìš”.
                const response = await fetch('./quiz.xlsx');
                const arrayBuffer = await response.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer);
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet);

                // ì»¬ëŸ¼ ì´ë¦„ì´ ìœ ë™ì ì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì²« ë²ˆì§¸ ë°ì´í„°ì˜ í‚¤(key)ë“¤ì„ ê¸°ë°˜ìœ¼ë¡œ ë§¤í•‘í•©ë‹ˆë‹¤.
                if (jsonData.length === 0) {
                    throw new Error('ì—‘ì…€ íŒŒì¼ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
                const headers = Object.keys(jsonData[0]); // ["ë‹¨ì–´ (Word)", "ì˜ì˜í’€ì´...", "ëœ»..."]
                
                // ë°ì´í„° í˜•ì‹ì„ { word, definition, meaning } ìœ¼ë¡œ í†µì¼í•©ë‹ˆë‹¤.
                allWords = jsonData.map(row => ({
                    word: row[headers[0]],       // ì²« ë²ˆì§¸ ì—´ì„ ë‹¨ì–´ë¡œ ê°€ì •
                    definition: row[headers[2]], // ì„¸ ë²ˆì§¸ ì—´ì„ ì˜ì˜í’€ì´ë¡œ ê°€ì •
                    meaning: row[headers[3]]     // ë„¤ ë²ˆì§¸ ì—´ì„ í•œê¸€ ëœ»ìœ¼ë¡œ ê°€ì •
                }));

                return true; // ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë¨
            } catch (error) {
                console.error('í€´ì¦ˆ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', error);
                alert('quiz.xlsx íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ì´ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì— ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
                return false; // ë¡œë“œ ì‹¤íŒ¨
            }
        }

        function shuffleArray(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        async function startGame() {
            startBtn.disabled = true;
            startBtn.textContent = 'ë°ì´í„° ë¡œë”© ì¤‘...';
            
            const isDataLoaded = await loadQuizData();
            if (!isDataLoaded) {
                startBtn.disabled = false;
                startBtn.textContent = 'í€´ì¦ˆ ì‹œì‘í•˜ê¸°';
                return; // ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨ ì‹œ ê²Œì„ ì‹œì‘ ì•ˆí•¨
            }

            startScreen.classList.add('hidden');
            resultsScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');

            // í€´ì¦ˆ ë‹¨ì–´ ìˆ˜ê°€ 10ê°œ ë¯¸ë§Œì¼ ê²½ìš°ë¥¼ ëŒ€ë¹„
            const quizSetLength = Math.min(QUIZ_LENGTH, allWords.length);
            shuffledWords = shuffleArray([...allWords]).slice(0, quizSetLength);
            currentWordIndex = 0;
            score = 0;
            incorrectAnswers = [];
            
            displayNextQuestion();
        }

        function displayNextQuestion() {
            const quizSetLength = shuffledWords.length;
            if (currentWordIndex < quizSetLength) {
                updateProgress();
                const currentWord = shuffledWords[currentWordIndex];
                
                // ì§ˆë¬¸ì´ ë  ë‚´ìš©(ì˜ì˜í’€ì´, í•œê¸€ëœ»)ì´ ë¹„ì–´ìˆì§€ ì•Šì€ì§€ í™•ì¸
                const questionText = currentWord.definition || currentWord.meaning;
                questionEl.textContent = questionText || "ì •ì˜ ì—†ìŒ"; // ë‘˜ ë‹¤ ë¹„ì–´ìˆì„ ê²½ìš° ëŒ€ë¹„

                const options = getOptions(currentWord);
                optionsContainer.innerHTML = '';

                options.forEach(option => {
                    const button = document.createElement('button');
                    button.textContent = option.word;
                    button.classList.add('w-full', 'p-4', 'text-lg', 'font-semibold', 'rounded-lg', 'btn-option');
                    button.onclick = () => selectAnswer(button, option.correct);
                    optionsContainer.appendChild(button);
                });
            } else {
                showResults();
            }
        }
        
        function getOptions(correctWord) {
            const options = [{ word: correctWord.word, correct: true }];
            const distractors = allWords.filter(w => w.word !== correctWord.word);
            const shuffledDistractors = shuffleArray(distractors);

            // ë³´ê¸° 3ê°œë¥¼ ì¶”ê°€. ì „ì²´ ë‹¨ì–´ ìˆ˜ê°€ 4ê°œ ë¯¸ë§Œì¼ ê²½ìš°ë¥¼ ëŒ€ë¹„
            const count = Math.min(3, shuffledDistractors.length);
            for (let i = 0; i < count; i++) {
                options.push({ word: shuffledDistractors[i].word, correct: false });
            }
            
            return shuffleArray(options);
        }

        function selectAnswer(button, isCorrect) {
            Array.from(optionsContainer.children).forEach(btn => {
                btn.disabled = true;
            });

            if (isCorrect) {
                score++;
                button.classList.add('correct');
            } else {
                button.classList.add('incorrect');
                incorrectAnswers.push(shuffledWords[currentWordIndex]);
                const correctButton = Array.from(optionsContainer.children).find(btn => {
                    const correctWord = shuffledWords[currentWordIndex].word;
                    return btn.textContent === correctWord;
                });
                if (correctButton) {
                    correctButton.classList.add('correct');
                }
            }

            setTimeout(() => {
                currentWordIndex++;
                displayNextQuestion();
            }, 1500);
        }
        
        function updateProgress() {
            const quizSetLength = shuffledWords.length;
            const progress = ((currentWordIndex + 1) / quizSetLength) * 100;
            progressText.textContent = `${currentWordIndex + 1} / ${quizSetLength}`;
            progressBar.style.width = `${progress}%`;
        }

        function showResults() {
            quizScreen.classList.add('hidden');
            resultsScreen.classList.remove('hidden');
            
            const quizSetLength = shuffledWords.length;
            scoreEl.textContent = `${score} / ${quizSetLength}`;
            incorrectList.innerHTML = '';

            if (incorrectAnswers.length === 0) {
                const li = document.createElement('li');
                li.textContent = 'ğŸ‰ ì™„ë²½í•´ìš”! í‹€ë¦° ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.';
                li.classList.add('text-green-600', 'font-semibold');
                incorrectList.appendChild(li);
            } else {
                incorrectAnswers.forEach(word => {
                    const li = document.createElement('li');
                    li.innerHTML = `<span class="font-bold text-gray-800">${word.word}</span>: ${word.meaning || word.definition}`;
                    li.classList.add('text-gray-600');
                    incorrectList.appendChild(li);
                });
            }
        }

        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', () => {
             // Reset start button state for next game
            startBtn.disabled = false;
            startBtn.textContent = 'í€´ì¦ˆ ì‹œì‘í•˜ê¸°';
            resultsScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
        });

    </script>
</body>
</html>
